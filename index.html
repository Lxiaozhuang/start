<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>htmltopic</title>
<!-- <script type="text/javascript" src="/h5/js/jquery-1.11.0.min.js"></script> -->
<script src="https://apps.bdimg.com/libs/jquery/2.1.4/jquery.min.js"></script>
<script src="https://cdn.bootcss.com/html2canvas/0.5.0-beta4/html2canvas.js"></script>
<script src="https://cdn.bootcss.com/jspdf/1.5.3/jspdf.debug.js"></script>
<script src="./js/echarts.simple.min.js"></script>
<style>
* {
margin: 0;
}
html{
background: #fff;
}
.test {
width: 400px;
height: 400px;
text-align: center;
line-height: 100px;
background-color: #fff;
display: inline-block;
vertical-align: top;

}
canvas {
margin-right: 5px;
}
.down {
float: left;
margin: 40px 10px;
}
.down2 {
float: left;
margin: 40px 30px;
}
</style>
</head>
<body>
<div id="main" style="width: 600px; height: 400px;"></div>
<div class="test img">
  <img src="https://timgsa.baidu.com/timg?image&quality=80&size=b9999_10000&sec=1548053494&di=edcca034d98faa44f2ec5c5b32b8808f&imgtype=jpg&er=1&src=http%3A%2F%2F08.imgmini.eastday.com%2Fmobile%2F20180121%2F20180121082236_cb320c44c26d567d65dcedb2fd95b02f_1.jpeg">
</div>
<div class="test">测试</div>

<div><button class="down" download="downImg">生成图片</button>
</div>
<!-- <div><a class="down2" href="" download="downImg">生成图片</a></div> -->
<script>

    // 基于准备好的dom，初始化echarts实例
		var myChart = echarts.init(document.getElementById('main'));
		
 
			// 3.更新图表myChart的数据
			option = {
    xAxis: {
        type: 'category',
        data: ['Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat', 'Sun']
    },
    yAxis: {
        type: 'value'
    },
    series: [{
        data: [820, 932, 901, 934, 1290, 1330, 1320],
        type: 'line'
    }]
};
			myChart.setOption(option);
		

</script>
<script>
        let down = document.querySelector('.down')
        //直接选择要截图的dom，就能截图，但是因为canvas的原因，生成的图片模糊
        //html2canvas(document.querySelector('div')).then(function(canvas) {
        // document.body.appendChild(canvas);
        //});
        //创建一个新的canvas
        var canvas2 = document.createElement("canvas");
        let
        _canvas = document.querySelector('html');
        //此处可换body，或div等
        var w = parseInt(window.getComputedStyle(_canvas).width);
        var h = parseInt(window.getComputedStyle(_canvas).height);
        //将canvas画布放大若干倍，然后盛放在较小的容器内，就显得不模糊了
        canvas2.width = w * 2;
        canvas2.height = h * 2;
        canvas2.style.width = w + "px";
        canvas2.style.height = h + "px";

        //可以按照自己的需求，对context的参数修改,translate指的是偏移量
        // var context = canvas.getContext("2d");
        // context.translate(0,0);
        var context = canvas2.getContext("2d");
        context.scale(2, 2);
        html2canvas(document.querySelector('html'), { canvas: canvas2 }).then(function(canvas) {
        //此处html可换body，或div等
        //document.body.appendChild(canvas);
        //canvas转换成url，然后利用a标签的download属性，直接下载，绕过上传服务器再下载
        //这个是下载图片的
        // document.querySelector(".down").setAttribute('href', canvas.toDataURL());

          //以下内容是转换成pdf下载的
        let contentWidth = canvas.width
        let contentHeight = canvas.height
        let pageHeight = contentWidth / 592.28 * 841.89
        let leftHeight = contentHeight
        let position = 0
        let imgWidth = 595.28
        let imgHeight = 592.28 / contentWidth * contentHeight

        let pageData = canvas.toDataURL('image/jpeg', 1.0)
        let pageData1 = canvas.toDataURL()
        console.log(pageData1)
        let PDF = new jsPDF('', 'pt', 'a4')
        if (leftHeight < pageHeight) {
          PDF.addImage(pageData, 'JPEG', 0, 0, imgWidth, imgHeight)
        } else {
          while (leftHeight > 0) {
            PDF.addImage(pageData, 'JPEG', 0, position, imgWidth, imgHeight)
            leftHeight -= pageHeight
            position -= 841.89
            if (leftHeight > 0) {
              PDF.addPage()
            }
          }
        }
        down.addEventListener('click',function(){
         PDF.save('title' + '.pdf');
        })
        
        });


</script>
<script language="javascript">
//这是另一种写法
// $(function () {
// $(".down2").click(function () {
// html2canvas($(".test")).then(function (canvas) {
// var imgUri = canvas.toDataURL("image/png").replace("image/png", "image/octet-stream"); // 获取生成的图片的url
// window.location.href = imgUri; // 下载图片
// });
//html2canvas($('.tongxingzheng_bg'), {
// onrendered: function (canvas) {
// var data = canvas.toDataURL("image/png");//生成的格式
// //data就是生成的base64码啦
// alert(data);
// }
//});
// });
// });
</script>

<script>
    
</script>
</body>
</html>
